<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ report_name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    
    <style>
        body {
            background-color: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        .container {
            max-width: 1200px;
            margin-top: 2rem;
            margin-bottom: 2rem;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            padding: 2.5rem;
        }
        h1, h2 {
            color: #343a40;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        h1 {
            font-size: 2.25rem;
            font-weight: 600;
        }
        h2 {
            font-size: 1.75rem;
            font-weight: 500;
            margin-top: 2.5rem;
        }
        .summary-box {
            background-color: #eef6ff;
            border-left: 5px solid #0d6efd;
            padding: 1.5rem;
            border-radius: 5px;
            font-size: 1.05rem;
            line-height: 1.6;
        }
        .metric-card {
            border: none;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            color: #fff;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        .metric-card .icon {
            font-size: 2.5rem;
            opacity: 0.3;
        }
        .metric-card .value {
            font-size: 2.25rem;
            font-weight: 700;
        }
        .metric-card .label {
            font-size: 1.1rem;
            font-weight: 500;
        }
        .metric-card .delta {
            font-size: 1.25rem;
            font-weight: 600;
        }
        .chart-container {
            padding: 1.5rem;
            background-color: #fdfdfd;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-top: 1rem;
        }
        /* Cores dos cards (baseadas no seu Python) */
        .card-total { background-color: #17a2b8; }
        .card-positivo { background-color: #4CAF50; }
        .card-neutro { background-color: #9E9E9E; }
        .card-negativo { background-color: #F44336; }
    </style>
</head>
<body>

    <script>
        const reportData = {{ report_data_json | safe }};
        const colorMap = {
            'Positivo': '#4CAF50',
            'Neutro': '#9E9E9E',
            'Negativo': '#F44336'
        };
    </script>

    <div class="container">
        <header class="mb-4">
            <h1>ðŸ“Š {{ report_name }}</h1>
        </header>

        <section>
            <h2>Resumo Executivo (IA)</h2>
            <div class="summary-box">
                {{ resumo_executivo | safe }}
            </div>
        </section>

        <section>
            <h2>MÃ©tricas Principais</h2>
            <div id="metric-cards-container" class="row"></div>
        </section>

        <section>
            <h2>AnÃ¡lise Detalhada</h2>
            <div class="row">
                <div class="col-lg-6">
                    <div class="chart-container">
                        <canvas id="sentimentPieChart"></canvas>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="chart-container">
                        <canvas id="genderPieChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="row mt-4">
                <div class="col-12">
                    <div class="chart-container">
                        <canvas id="timelineChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="row mt-4">
                <div class="col-lg-6">
                    <div class="chart-container">
                        <canvas id="genderBarChart"></canvas>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="chart-container">
                        <canvas id="wordFreqChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="row mt-4">
                 <div class="col-lg-6">
                    <div class="chart-container">
                        <canvas id="emojiFreqChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h2>Amostra de Dados</h2>
            <div class="table-responsive">
                {{ tabela_amostra | safe }}
            </div>
        </section>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            
            // --- 1. Renderizar Cards de MÃ©trica ---
            const metricsContainer = document.getElementById('metric-cards-container');
            if (reportData.metrics) {
                reportData.metrics.forEach(metric => {
                    let cardClass = '';
                    if (metric.label === 'Positivos') cardClass = 'card-positivo';
                    else if (metric.label === 'Neutros') cardClass = 'card-neutro';
                    else if (metric.label === 'Negativos') cardClass = 'card-negativo';
                    else cardClass = 'card-total';

                    metricsContainer.innerHTML += `
                        <div class="col-lg-3 col-md-6">
                            <div class="metric-card ${cardClass}">
                                <div class="row">
                                    <div class="col-8">
                                        <div class="value">${metric.value}</div>
                                        <div class="label">${metric.label}</div>
                                        <div class="delta">${metric.delta}</div>
                                    </div>
                                    <div class="col-4 d-flex align-items-center justify-content-end">
                                        <i class="fa ${metric.icon} icon"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }

            // --- 2. Renderizar GrÃ¡ficos ---
            const chartColors = reportData.sentiment_counts ? reportData.sentiment_counts.labels.map(label => colorMap[label] || '#cccccc') : [];

            // GrÃ¡fico de Pizza: Sentimentos
            if (reportData.sentiment_counts) {
                new Chart(document.getElementById('sentimentPieChart'), {
                    type: 'pie',
                    data: {
                        labels: reportData.sentiment_counts.labels,
                        datasets: [{
                            data: reportData.sentiment_counts.data,
                            backgroundColor: chartColors
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'top' },
                            title: { display: true, text: 'DistribuiÃ§Ã£o de Sentimentos', font: { size: 16 } }
                        }
                    }
                });
            }
            
            // GrÃ¡fico de Pizza: GÃªnero
            if (reportData.gender_pie_counts) {
                new Chart(document.getElementById('genderPieChart'), {
                    type: 'doughnut',
                    data: {
                        labels: reportData.gender_pie_counts.labels,
                        datasets: [{
                            data: reportData.gender_pie_counts.data
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'top' },
                            title: { display: true, text: 'DistribuiÃ§Ã£o de GÃªnero (Previsto)', font: { size: 16 } }
                        }
                    }
                });
            }

            // GrÃ¡fico de Linha: Timeline
            if (reportData.timeline) {
                new Chart(document.getElementById('timelineChart'), {
                    type: 'line',
                    data: {
                        labels: reportData.timeline.labels,
                        datasets: [{
                            label: 'Volume de ComentÃ¡rios',
                            data: reportData.timeline.data,
                            borderColor: '#0d6efd',
                            backgroundColor: 'rgba(13, 110, 253, 0.1)',
                            fill: true,
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false },
                            title: { display: true, text: 'Linha do Tempo', font: { size: 16 } }
                        }
                    }
                });
            }

            // GrÃ¡fico de Barras: GÃªnero e Sentimento
            if (reportData.gender_bar_counts) {
                new Chart(document.getElementById('genderBarChart'), {
                    type: 'bar',
                    data: {
                        labels: reportData.gender_bar_counts.labels,
                        datasets: reportData.gender_bar_counts.datasets.map(ds => ({
                            ...ds,
                            backgroundColor: colorMap[ds.label] || '#cccccc'
                        }))
                    },
                    options: {
                        responsive: true,
                        scales: { x: { stacked: false }, y: { stacked: false } },
                        plugins: {
                            legend: { position: 'top' },
                            title: { display: true, text: 'Sentimento por GÃªnero', font: { size: 16 } }
                        }
                    }
                });
            }

            // GrÃ¡fico de Barras: Termos Frequentes
            if (reportData.word_freq) {
                new Chart(document.getElementById('wordFreqChart'), {
                    type: 'bar',
                    data: {
                        labels: reportData.word_freq.labels,
                        datasets: [{
                            label: 'FrequÃªncia',
                            data: reportData.word_freq.data,
                            backgroundColor: '#17a2b8'
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        plugins: {
                            legend: { display: false },
                            title: { display: true, text: 'Top 20 Termos Frequentes', font: { size: 16 } }
                        }
                    }
                });
            }
            
            // GrÃ¡fico de Barras: Emojis Frequentes
            if (reportData.emoji_freq) {
                new Chart(document.getElementById('emojiFreqChart'), {
                    type: 'bar',
                    data: {
                        labels: reportData.emoji_freq.labels,
                        datasets: [{
                            label: 'FrequÃªncia',
                            data: reportData.emoji_freq.data,
                            backgroundColor: '#ffc107'
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        plugins: {
                            legend: { display: false },
                            title: { display: true, text: 'Top 15 Emojis', font: { size: 16 } }
                        }
                    }
                });
            }

        });
    </script>
</body>
</html>